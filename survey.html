<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Edumindcare – Làm Khảo Sát</title>
<style>

  /* ====== Design tokens ====== */
  :root{
    --brand:#3b82f6;        /* blue-500 */
    --brand-600:#2563eb;
    --ink:#111827;          /* neutral-900 */
    --muted:#4b5563;        /* neutral-600 */
    --bg:#ffffff;
    --gray-50:#f8fafc;
    --border:#e5e7eb;
    --shadow:0 12px 30px rgba(17,24,39,.08);
  }

  /* ====== Base ====== */
  html{scroll-behavior:smooth}
  body{
    margin:0;
    font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
    font-size:16px;
    line-height:1.65;
    color:var(--ink);
    background:var(--bg);
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
  }
  img{max-width:100%; display:block}
  a{color:inherit; text-decoration:none}

  /* ====== Layout ====== */
  .container{max-width:1200px; padding:0 20px; margin:0 auto}
  .section{padding:64px 0}
  @media(min-width:1024px){ .section{padding:84px 0} }
  .alt{background:var(--gray-50)}
  .divider{height:1px; background:var(--border)}

  /* ====== Typography (simple & clear) ====== */
  .title-xxl{font-size:44px; line-height:1.15; font-weight:800; letter-spacing:0}
  @media(min-width:768px){ .title-xxl{font-size:56px} }
  .title-xl{font-size:30px; line-height:1.25; font-weight:800}
  @media(min-width:768px){ .title-xl{font-size:38px} }
  .lead{font-size:17px; color:var(--muted)}

  /* ====== Buttons ====== */
  .btn{display:inline-flex; align-items:center; gap:10px; padding:12px 18px; border-radius:12px; font-weight:800}
  .btn-lg{padding:14px 22px; font-size:16px}
  .btn-primary{background:#fff; color:#111; border:1.5px solid rgba(59,130,246,.5); box-shadow:0 10px 20px rgba(59,130,246,.15)}
  .btn-primary:hover{border-color:var(--brand); box-shadow:0 12px 26px rgba(59,130,246,.22)}
  .btn-white{background:#fff; border:1px solid var(--border); color:#111}
  .btn-white:hover{background:#f5f5f5}

  /* ====== Header ====== */
  .navbar{position:sticky; top:0; z-index:50; background:rgba(255,255,255,.95); backdrop-filter:saturate(160%) blur(8px); border-bottom:1px solid var(--border); transition:box-shadow .2s ease}
  .navbar.scrolled{box-shadow:0 6px 18px rgba(17,24,39,.06)}
  .nav-row{display:flex; align-items:center; justify-content:space-between; gap:16px; padding:12px 16px}
  .brand{font-size:28px; font-weight:800}
  @media(min-width:900px){ .brand{font-size:30px} }
  .nav-links{display:none; gap:26px; font-weight:700; font-size:15px}
  .nav-links a{opacity:.9}
  .nav-links a:hover{opacity:1}
  @media(min-width:900px){ .nav-links{display:flex} }

  /* ====== Grid & Media ====== */
  .grid-2{display:grid; grid-template-columns:1fr; gap:28px; align-items:center}
  @media(min-width:1024px){ .grid-2{grid-template-columns:1fr 1fr; gap:44px} }
  .half-img{height:280px; border-radius:16px; overflow:hidden; border:1px solid var(--border); box-shadow:var(--shadow)}
  .half-img>img{width:100%; height:100%; object-fit:cover; object-position:center}
  @media(min-width:768px){ .half-img{height:420px} }
  @media(min-width:1200px){ .half-img{height:520px} }

  /* ====== Hero ====== */
  .hero{display:grid; grid-template-columns:1fr; align-items:stretch}
  @media(min-width:1024px){ .hero{grid-template-columns:1fr 1fr} }
  .hero-text{background:#0b0b0b; color:#fff; padding:36px}
  @media(min-width:640px){ .hero-text{padding:48px} }
  @media(min-width:1024px){ .hero-text{padding:84px 68px} }
  .hero-media{position:relative; height:360px}
  @media(min-width:640px){ .hero-media{height:460px} }
  @media(min-width:1024px){ .hero-media{height:auto} }
  .hero-media img{width:100%; height:100%; object-fit:cover}
  .overlay{position:absolute; inset:0; background:linear-gradient(to top, rgba(0,0,0,.3), transparent 55%)}
  .hero-inner{max-width:720px}
  .hero-lead{color:#d1d5db}

  /* ====== Features ====== */
  .features{display:grid; grid-template-columns:1fr; gap:16px}
  @media(min-width:900px){ .features{grid-template-columns:repeat(3,1fr)} }
  .feature{border:1px solid var(--border); border-radius:14px; padding:20px; background:#fff; transition:transform .2s ease, box-shadow .2s ease}
  .feature:hover{transform:translateY(-2px); box-shadow:var(--shadow)}
  .feature .icon{font-size:24px}
  .feature h4{margin:10px 0 6px; font-size:18px; font-weight:800}

  /* ====== CTA ====== */
  .cta{border:1px solid rgba(59,130,246,.25); background:#fff; border-radius:20px; text-align:center; padding:48px 22px}
  .cta .title{font-size:36px; font-weight:800}

  /* ====== Forms ====== */
  .input{width:100%; padding:12px 14px; border:1px solid #d1d5db; border-radius:10px; outline:none; font-size:16px}
  .input:focus{border-color:var(--brand); box-shadow:0 0 0 3px rgba(59,130,246,.15)}

  /* ====== Reveal animation (smoother) ====== */
  .reveal{
    opacity:0;
    transform:translateY(18px) scale(.995);
    filter:blur(4px);
    transition:
      opacity .8s cubic-bezier(.22,1,.36,1),
      transform .8s cubic-bezier(.22,1,.36,1),
      filter .8s cubic-bezier(.22,1,.36,1);
    will-change:opacity, transform, filter;
  }
  .reveal.in-view{
    opacity:1;
    transform:none;
    filter:none;
  }
  @media (prefers-reduced-motion: reduce){
    .reveal{transition:none; transform:none; filter:none; opacity:1}
  }


  :root{
    --ink:#0f172a;
    --muted:#475569;
    --border:#e5e7eb;
    --brand:#111;
    --link:#111;
    --accent:#3b82f6;
    --card:#f8fafc;
    --good:#10b981; --warn:#f59e0b; --bad:#ef4444;
  }
  html{scroll-behavior:smooth}
  body{margin:0; background:#fff; color:var(--ink);
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,Noto Sans,sans-serif}
  a{color:var(--link); text-decoration:none}
  a:hover{opacity:.8}
  .container{max-width:1200px; padding:0 20px; margin:0 auto}

  /* Header like v6: brand on left, plain links on right */
  .navbar{position:sticky; top:0; z-index:40; background:#fff; border-bottom:1px solid var(--border)}
  .nav-row{display:flex; align-items:center; justify-content:space-between; padding:14px 0}
  .brand{font-weight:900; letter-spacing:.12em; font-size:28px}
  .links{display:flex; align-items:center; gap:28px}
  .links a{font-weight:800; font-size:16px}

  /* Hero */
  .hero{padding:28px 0 8px}
  .hero h1{font-size:40px; line-height:1.15; margin:0 0 6px; font-weight:900}
  .hero p{color:var(--muted); margin:0}

  /* Cards & questions */
  .card{background:var(--card); border:1px solid var(--border); border-radius:16px; padding:16px; margin-top:14px}
  .section-title{font-size:22px; font-weight:900; margin:6px 0 6px}
  .q{padding:14px; background:#fff; border:1px solid var(--border); border-radius:14px; margin:12px 0}
  .q.invalid{border-color:var(--bad); box-shadow:0 0 0 3px rgba(239,68,68,.12)}
  .q h4{margin:0 0 10px; font-size:16px}
  .opt{display:grid; gap:10px}
  .opt.opt-4{grid-template-columns:repeat(4,minmax(0,1fr))}
  .opt.opt-5{grid-template-columns:repeat(5,minmax(0,1fr))}
  .opt label{display:flex; align-items:center; justify-content:center; gap:8px;
             padding:12px 10px; border:1.5px solid var(--border); border-radius:12px;
             cursor:pointer; user-select:none; background:#fafafa; text-align:center;
             font-weight:800; white-space:nowrap}
  input[type=radio]{display:none}
  input[type=radio]:checked + label{border-color:#cbd5e1; background:#eef2ff}

  .subtle{color:var(--muted); font-size:14px}

  /* Plain buttons to match site style */
  .btn{display:inline-flex; align-items:center; justify-content:center; padding:10px 16px;
       border-radius:12px; border:1.5px solid #cbd5e1; background:#fff; color:#111; font-weight:800}
  .btn:hover{border-color:#a5b4fc}
  .btn.secondary{background:#fff}

  /* Result */
  .result{display:none; margin-top:16px}
  .pill{display:inline-block; padding:6px 10px; border-radius:999px; font-weight:800; font-size:12px; margin-right:6px}
  .good{background:rgba(16,185,129,.12); color:var(--good)}
  .warn{background:rgba(245,158,11,.12); color:var(--warn)}
  .bad{background:rgba(239,68,68,.12); color:var(--bad)}

  .alert{display:none; background:#fef2f2; border:1px solid #fecaca; color:#991b1b; border-radius:12px; padding:12px 14px; margin-top:12px; font-size:14px}
  .note{display:none; background:#fff7ed; border:1px solid #fed7aa; color:#9a3412; border-radius:12px; padding:10px 12px; font-size:14px; margin-top:10px}
  .games{display:none; margin-top:14px}
  .game-grid{display:grid; grid-template-columns:repeat(2,minmax(0,1fr)); gap:12px}
  .game{background:#fff; border:1px solid var(--border); border-radius:12px; padding:12px}
  .game h5{margin:0 0 4px; font-size:15px}
  .game p{margin:0; font-size:13px; color:var(--muted)}

  footer{padding:28px 0 36px; border-top:1px solid var(--border); margin-top:26px}
  .footer-row{display:flex; align-items:center; justify-content:space-between; gap:16px; flex-wrap:wrap; color:var(--muted); font-size:14px}
  .footer-links{display:flex; gap:22px; flex-wrap:wrap; font-weight:800}

  /* Active link underline for current page */
  .links a[aria-current="page"]{text-decoration:underline}
  /* Slightly larger max-width to match other pages */
  .container{max-width:1260px; padding:0 24px; margin:0 auto}
  /* Sticky header with subtle blur like site */
  .navbar{position:sticky; top:0; z-index:50; background:rgba(255,255,255,.96);
          border-bottom:1px solid var(--border); backdrop-filter:saturate(160%) blur(8px)}
  /* Spacing polish */
  .hero{padding:36px 0 6px}
  .card{padding:20px}
  .q h4{font-size:17px}
  .btn{padding:12px 18px; border-radius:12px}
  #calcBtn{border-color:#a5b4fc}
  /* Result panel visual */
  #result.card{background:#fff; border:1.5px solid var(--border)}


  /* === Alignment polish for survey === */
  .hero .container, main.container{max-width:980px}
  .hero h1{margin:0 0 8px; font-weight:900; letter-spacing:.01em}
  .hero .subtle{margin:0 0 10px; font-size:17px; line-height:1.7}
  main.container{display:flex; flex-direction:column; gap:22px}
  .card{border:1px solid var(--border); border-radius:16px; padding:24px}
  .section-title{margin:0 0 6px}

  /* === Straight column alignment === */
  .hero .container, main.container{max-width:1140px}
  .q{margin:14px 0}
  .opt{display:grid; grid-template-columns:repeat(4,1fr); gap:14px}
  .opt.opt-5{grid-template-columns:repeat(5,1fr)}
  .opt label{padding:14px 14px; font-size:16px}
  .opt label span.value{min-width:36px; display:inline-block; text-align:center}

  /* === Hero refresh: centered title + cheerful background === */
  .hero{
    padding:56px 0 24px;
    background:
      radial-gradient(1200px 500px at 0% 0%, rgba(59,130,246,.12), transparent 60%),
      radial-gradient(900px 400px at 100% 0%, rgba(16,185,129,.12), transparent 60%),
      radial-gradient(1200px 520px at 50% 100%, rgba(250,204,21,.14), transparent 60%),
      linear-gradient(180deg, #ffffff, #f8fafc);
  }
  .hero .container{
    max-width: 960px;
    text-align:center;
  }
  .hero h1{
    margin: 0 0 10px;
    font-weight: 900;
    letter-spacing: .01em;
  }
  .hero .subtle{
    color:#475569;
    font-size:17px;
    margin:0 auto;
  }


  /* Right-aligned hero copy but centered block */
  .hero-copy{
    max-width: 760px;
    margin: 0 auto;
    text-align: right;
  }


  /* Two-line right-shifted hero text */
  p%;
    max-width: 960px;
    margin-left: auto;  /* push block to the right while staying centered within page grid */
    text-align: right;
    line-height: 1.25;
  }
  .hero-copy-right h1{
    margin: 0 0 .35rem 0;
    font-size: clamp(28px, 4.6vw, 56px);
    font-weight: 800;
    letter-spacing: 0.2px;
  
    white-space: nowrap;}
  .hero-copy-right .subtitle{
    margin: 0;
    font-size: clamp(14px, 1.4vw, 18px);
    opacity: 0.9;
  
    white-space: nowrap;}


/* === Inline Whack-a-mole preview + modal === */
.game{background:#fff; border:1px solid var(--border); border-radius:16px; overflow:hidden; padding:0}
.game .thumb{width:100%; aspect-ratio:16/9; display:block; border-bottom:1px solid var(--border)}
.game .body{padding:12px 14px 16px}
.game h5{margin:0 0 6px; font-size:16px}
.game p{margin:0 0 10px; color:var(--muted); font-size:13px}
.btn.small{padding:8px 12px; font-size:14px; border-radius:10px}

/* Preview art */
.thumb.whack{background:linear-gradient(135deg,#dbeafe,#fef9c3); position:relative}
.thumb.whack::before{content:""; position:absolute; inset:auto 12% 8% 12%; height:55%; border-radius:16px; background:linear-gradient(180deg,#fde68a,#f59e0b); box-shadow:0 8px 16px rgba(245,158,11,.25)}

/* Modal */
.modal{position:fixed; inset:0; background:rgba(2,6,23,.5); display:none; z-index:1000; align-items:center; justify-content:center; padding:18px}
.modal.show{display:flex}
.modal-dialog{width:min(880px,95vw); background:#fff; border-radius:16px; overflow:hidden; border:1px solid var(--border); box-shadow:0 20px 60px rgba(2,6,23,.35)}
.modal-header{display:flex; align-items:center; justify-content:space-between; padding:14px 16px; border-bottom:1px solid var(--border)}
.modal-body{padding:16px}
.modal-close{background:white; border:1px solid var(--border); border-radius:10px; padding:6px 10px; cursor:pointer}
.game-wrap{padding:0}
.game-wrap>*{width:100%}

/* Whack-a-mole (3x3) */
.wam-wrap{display:flex;flex-direction:column;align-items:center;gap:10px}
.wam-hud{display:flex;gap:12px;align-items:center;font-weight:700}
.wam-hud .pill{background:#ecfeff;color:#0369a1;padding:4px 10px;border-radius:999px}
.wam-board{width:min(92vw,420px);aspect-ratio:1/1;display:grid;grid-template-columns:repeat(3,1fr);gap:10px;padding:10px;border-radius:16px;background:#f8fafc;border:1px solid var(--border)}
.wam-hole{position:relative;border-radius:14px;background:#ffffff;box-shadow:inset 0 0 0 1px var(--border),0 6px 14px rgba(15,23,42,.08);overflow:hidden;cursor:pointer;user-select:none}
.wam-mole{position:absolute;inset:auto 12% 6% 12%;height:58%;border-radius:16px;background:linear-gradient(180deg,#fde68a,#f59e0b);display:none;box-shadow:0 8px 16px rgba(245,158,11,.25)}
.wam-hole.active .wam-mole{display:block}
.wam-ctrl{display:flex;gap:10px;margin-top:6px}
.wam-ctrl .btn{padding:10px 14px}


  /* ===== Brand logo (file-based) ===== */
  .brand{display:flex; align-items:center; gap:12px; font-weight:800}
  .brand .logo{height:56px; width:auto; object-fit:contain; display:block}
  @media(min-width:900px){ .brand .logo{height:68px} }


footer{padding:32px 0; border-top:1px solid var(--border)}
.footer-links{display:flex; gap:22px; justify-content:center; flex-wrap:wrap; font-weight:700; font-size:14px}
.divider{height:1px; background:var(--border); max-width:820px; margin:12px auto}
.footer-meta{display:flex; justify-content:space-between; align-items:center; gap:16px; max-width:820px; margin:0 auto; color:var(--muted); font-size:14px}
</style>
</head>
<body>
<header class="navbar" id="navbar">
    <nav class="container nav-row">
      <a href="index.html" class="brand"><img class="logo" src="logo.jpg" alt="Logo Trần Đại Nghĩa"><span>Edumindcare</span></a>
      <div class="nav-links">
        <a href="about.html">Phương pháp của Chúng tôi</a>
        <a href="games.html">Trò Chơi Giảm Căng Thẳng</a>
        <a href="survey.html" aria-current="page">Khảo Sát</a>
        <a href="contact.html">Liên Hệ</a>
      </div>
    </nav>
  </header>

<section class="hero">
  <div class="container"><div class="hero-copy-right"><h1>KHẢO SÁT SỨC KHỎE TÂM THẦN HỌC</h1><p class="subtitle">Ứng dụng trí tuệ nhân tạo (AI) trong phát hiện sớm các dấu hiệu rối loạn sức khỏe tâm thần</p></div></div>
</section>

<main class="container">
  <div id="phq" class="card">
    <h2 class="section-title">PHQ‑9 (Trầm cảm — 2 tuần qua)</h2>
    <div class="subtle">Chọn một phương án cho mỗi câu hỏi.</div>
    <div id="phq-qs"></div>
  </div>

  <div id="gad" class="card">
    <h2 class="section-title">GAD‑7 (Lo âu — 2 tuần qua)</h2>
    <div class="subtle">Chọn một phương án cho mỗi câu hỏi.</div>
    <div id="gad-qs"></div>
  </div>

  <div style="display:flex; gap:12px; margin:8px 0 16px">
    <button id="calcBtn" class="btn">Kiểm tra</button>
    <button id="resetBtn" class="btn secondary">Xóa lựa chọn</button>
  </div>

  <div id="alert" class="alert"></div>

  <div id="result" class="card result">
    <h3 style="margin:6px 0 8px; font-size:20px; font-weight:900">Kết quả dự đoán</h3>
    <div class="subtle">Đây là công cụ sàng lọc – không thay thế tư vấn y khoa.</div>
    <div id="badges" style="margin-top:10px"></div>
    <div id="safety" class="note"></div>
    <div id="games" class="games">
      <h4 style="margin:12px 0 6px; font-size:18px">Gợi ý trò chơi & hoạt động</h4>
      <div id="games-grid" class="game-grid"></div>
      <div style="margin-top:12px"><a class="btn" href="gamelist.html">Xem thêm trò chơi</a></div>
    </div>
  </div>

<div id="gameModal" class="modal" role="dialog" aria-modal="true" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-header">
      <h3 id="modalTitle" style="margin:0; font-size:18px; font-weight:800">Chơi</h3>
      <button class="modal-close" id="modalClose">Đóng</button>
    </div>
    <div class="modal-body"><div id="gameMount" class="game-wrap"></div></div>
  </div>
</div>

</main>

<footer>
  <div class="container" style="text-align:center">
    <div class="footer-links">
      <a href="index.html">Trang Chủ</a>
      <a href="about.html">Phương Pháp</a>
      <a href="gamelist.html">Trò Chơi</a>
      <a href="survey.html">Khảo Sát</a>
      <a href="contact.html">Liên Hệ</a>
    </div>
    <div class="divider"></div>
    <div class="footer-meta">
      <p>Bản quyền © 2025 Edumindcare. Đã đăng ký Bản quyền.</p>
      <div style="display:flex; gap:16px">
        <a href="terms.html">Điều Khoản & Điều Kiện</a>
        <a href="privacy.html">Chính Sách Bảo Mật</a>
      </div>
    </div>
  </div>
</footer>

<script>
// Data
const PHQ = [
  "Trong 2 tuần qua, bạn có thấy ít hứng thú hoặc ít niềm vui khi làm các hoạt động thường ngày (học tập, công việc, sinh hoạt cá nhân…)?",
  "Bạn có cảm giác buồn bã, chán nản, tuyệt vọng, hoặc tinh thần đi xuống hầu như không cải thiện?",
  "Bạn có khó ngủ, ngủ chập chờn, tỉnh giấc giữa đêm hoặc ngủ quá nhiều so với bình thường?",
  "Bạn mệt mỏi, thiếu năng lượng hoặc dễ kiệt sức ngay cả khi làm những việc đơn giản?",
  "Bạn có chán ăn, ăn kém hoặc ngược lại ăn nhiều hơn bình thường vì cảm xúc?",
  "Bạn có cảm giác tự ti, tự trách, cho rằng mình là gánh nặng, kém giá trị so với người khác?",
  "Bạn thấy khó tập trung khi làm việc/học, đọc sách, xem phim hay trò chuyện với người khác?",
  "Bạn có lúc cử động chậm, uể oải, hoặc bồn chồn, đứng ngồi không yên đến mức người khác nhận ra?",
  "Trong 2 tuần qua, có khi nào bạn nghĩ rằng mình không muốn tồn tại hoặc có ý nghĩ làm tổn hại bản thân?"
];
const GAD = [
  "Bạn có thường xuyên căng thẳng, lo lắng, bồn chồn mà khó giải thích rõ nguyên nhân?",
  "Khi lo lắng, bạn có khó dừng lại hoặc khó kiểm soát dòng suy nghĩ lo âu?",
  "Bạn có lo nghĩ quá nhiều về nhiều vấn đề (công việc, học tập, sức khỏe, gia đình…), khó tách ra nghỉ ngơi?",
  "Bạn thấy khó thư giãn, khó tìm được trạng thái bình tĩnh ngay cả khi đã rảnh?",
  "Bạn có cảm giác bồn chồn, khó ngồi yên, cơ thể căng hoặc giật mình dễ dàng?",
  "Bạn dễ cáu hoặc dễ khó chịu hơn bình thường, phản ứng mạnh trước chuyện nhỏ?",
  "Bạn lo sợ điều xấu sắp xảy ra, hay dự cảm bất an liên tục?"
];
const LABELS_04 = ["Không hề","Vài ngày","Hơn nửa số ngày","Gần như mỗi ngày"];

function renderScale(container, list, name, labels){
  list.forEach((text, i)=>{
    const q = document.createElement('div');
    q.className = 'q';
    q.dataset.group = name; q.dataset.index = i;
    const h = document.createElement('h4');
    h.textContent = (i+1)+'. '+text;
    q.appendChild(h);
    const opt = document.createElement('div');
    opt.className = 'opt opt-'+labels.length;
    for(let v=0; v<labels.length; v++){
      const id = `${name}-${i}-${v}`;
      const input = Object.assign(document.createElement('input'), {type:'radio', name:`${name}-${i}`, id, value:v});
      const lab = document.createElement('label'); lab.htmlFor = id; lab.textContent = `${v} — ${labels[v]}`;
      opt.appendChild(input); opt.appendChild(lab);
    }
    q.appendChild(opt);
    container.appendChild(q);
  });
}
renderScale(document.getElementById('phq-qs'), PHQ, 'phq', LABELS_04);
renderScale(document.getElementById('gad-qs'), GAD, 'gad', LABELS_04);

function getSum(prefix, count){
  let sum=0, answered=0;
  for(let i=0;i<count;i++){
    const checked = document.querySelector(`input[name="${prefix}-${i}"]:checked`);
    if(checked){ sum+= +checked.value; answered++; }
  }
  return {sum, answered};
}

function interpretPHQLabel(s){
  if(s<=4) return {label:'không/nhẹ', cls:'good'};
  if(s<=9) return {label:'nhẹ', cls:'good'};
  if(s<=14) return {label:'trung bình', cls:'warn'};
  if(s<=19) return {label:'khá nặng', cls:'bad'};
  return {label:'nặng', cls:'bad'};
}
function interpretGADLabel(s){
  if(s<=4) return {label:'tối thiểu', cls:'good'};
  if(s<=9) return {label:'nhẹ', cls:'good'};
  if(s<=14) return {label:'trung bình', cls:'warn'};
  return {label:'nặng', cls:'bad'};
}

const GAMES_LOW=[
  {title:"Tô màu thư giãn",desc:"Tập trung nhẹ nhàng, giúp dịu cảm xúc."},
  {title:"Ghép hình 3×3",desc:"Tăng chú ý ngắn, cảm giác hoàn thành."},
  {title:"Xếp gạch cổ điển",desc:"Nhịp đều, giảm xao nhãng."},
  {title:"Nông trại vui vẻ",desc:"Tác vụ nhỏ, giải tỏa nhẹ."},
  {title:"Sudoku dễ",desc:"Rèn tập trung 5–10 phút."}
];
const GAMES_MED=[
  {title:"Play Together (mini game)",desc:"Tương tác xã hội, giải tỏa áp lực."},
  {title:"Tô màu nâng cao + thở",desc:"Hít thở hộp 4×4×4×4."},
  {title:"Ghép hình lớn",desc:"Chia mục tiêu nhỏ, giảm áp lực."},
  {title:"Đi bộ & nghe nhạc",desc:"10–15 phút, hạ nhịp thần kinh."},
  {title:"Rhythm lite",desc:"Giải phóng năng lượng vừa."}
];
const GAMES_HIGH=[
  {title:"Hít thở 4‑7‑8 + grounding",desc:"Ổn định nhanh 3–5 phút."},
  {title:"Nhật ký 3 phút",desc:"Đặt tên cảm xúc, gỡ rối suy nghĩ."},
  {title:"Action lite 5 phút",desc:"Xả năng lượng có kiểm soát."},
  {title:"Liên hệ người tin cậy",desc:"Trò chuyện làm dịu căng thẳng."},
  {title:"Thiền body scan",desc:"Thư giãn toàn thân ngắn."}
];

function pickFour(arr){ return arr.slice(0,4); }

function validateAll(){
  document.querySelectorAll('.q.invalid').forEach(el=>el.classList.remove('invalid'));
  const missing=[];
  document.querySelectorAll('.q').forEach(q=>{
    const name = `${q.dataset.group}-${q.dataset.index}`;
    const checked = document.querySelector(`input[name="${name}"]:checked`);
    if(!checked){ q.classList.add('invalid'); missing.push(`${q.dataset.group.toUpperCase()}-${+q.dataset.index+1}`); }
  });
  const alertBox=document.getElementById('alert');
  if(missing.length){
    alertBox.style.display='block';
    alertBox.innerHTML="<b>Cần hoàn thiện khảo sát:</b> thiếu câu "+missing.join(', ');
    document.querySelector('.q.invalid').scrollIntoView({behavior:'smooth',block:'center'});
    return false;
  }else{
    alertBox.style.display='none'; alertBox.innerHTML="";
    return true;
  }
}

function computeLabels(){
  const phq=getSum('phq',PHQ.length);
  const gad=getSum('gad',GAD.length);
  return {
    phq:interpretPHQLabel(phq.sum),
    gad:interpretGADLabel(gad.sum),
    suThought:+document.querySelector('input[name="phq-8"]:checked').value
  };
}

document.getElementById('calcBtn').addEventListener('click',()=>{
  if(!validateAll()) return;
  const lv=computeLabels();
  const badges=document.getElementById('badges'); badges.innerHTML="";
  const map={PHQ:lv.phq,GAD:lv.gad};
  Object.keys(map).forEach(k=>{
    const s=document.createElement('span'); s.className='pill '+map[k].cls; s.textContent=`${k}: ${map[k].label}`; badges.appendChild(s);
  });
  const safety=document.getElementById('safety');
  if(lv.suThought>=1){ safety.style.display='block'; safety.innerHTML="<b>Lưu ý an toàn:</b> Nếu có ý nghĩ tự hại, hãy tìm trợ giúp ngay (115 / cơ sở y tế / người tin cậy)."; }
  else { safety.style.display='none'; safety.innerHTML=""; }

  const severe=(lv.phq.cls==='bad')||(lv.gad.cls==='bad');
  const moderate=(lv.phq.cls==='warn')||(lv.gad.cls==='warn');
  const list= severe?pickFour(GAMES_HIGH): (moderate?pickFour(GAMES_MED):pickFour(GAMES_LOW));

  const grid=document.getElementById('games-grid'); grid.innerHTML="";
  list.forEach(g=>{ const c=document.createElement('div'); c.className='game'; c.innerHTML=`<h5>${g.title}</h5><p>${g.desc}</p>`; grid.appendChild(c); });
  document.getElementById('games').style.display='block';

  const result=document.getElementById('result'); result.style.display='block'; result.scrollIntoView({behavior:'smooth',block:'start'});
});

document.getElementById('resetBtn').addEventListener('click',()=>{
  document.querySelectorAll('input[type=radio]').forEach(r=>r.checked=false);
  document.getElementById('alert').style.display='none';
  document.getElementById('result').style.display='none';
  document.querySelectorAll('.q.invalid').forEach(el=>el.classList.remove('invalid'));
});

document.addEventListener('change',e=>{
  if(e.target.matches('input[type=radio]')){
    const [group,idx]=e.target.name.split('-');
    const q=document.querySelector(`.q[data-group="${group}"][data-index="${idx}"]`);
    if(q) q.classList.remove('invalid');
  }
});

// ==== Modal ====
const __modal=(()=>{const el=document.getElementById('gameModal');const titleEl=document.getElementById('modalTitle');const mount=document.getElementById('gameMount');const closeBtn=document.getElementById('modalClose');function open({title,build}){titleEl.textContent=title||'Trò chơi';mount.innerHTML='';build&&build(mount);el.classList.add('show');el.setAttribute('aria-hidden','false')}function close(){el.classList.remove('show');el.setAttribute('aria-hidden','true');mount.innerHTML=''}closeBtn.addEventListener('click',close);el.addEventListener('click',e=>{if(e.target===el)close()});document.addEventListener('keydown',e=>{if(e.key==='Escape'&&el.classList.contains('show'))close()});return{open,close}})();

// ==== Whack-a-mole builder ====

function buildWhack(m){
  const wrap=document.createElement('div'); wrap.className='wam-wrap';
  const hud=document.createElement('div'); hud.className='wam-hud';
  hud.innerHTML='<span class="pill" id="wamTime">30s</span><span class="pill">Điểm: <b id="wamScore">0</b></span><span class="pill">Cấp: <b id="wamLv">1</b></span>';
  const board=document.createElement('div'); board.className='wam-board';
  for(let i=0;i<9;i++){ const h=document.createElement('div'); h.className='wam-hole'; h.innerHTML='<div class="wam-mole"></div>'; board.appendChild(h); }
  const ctrl=document.createElement('div'); ctrl.className='wam-ctrl'; ctrl.innerHTML='<button class="btn" id="wamStart">Bắt đầu</button>';
  wrap.appendChild(hud); wrap.appendChild(board); wrap.appendChild(ctrl); m.appendChild(wrap);

  // Progressive difficulty:
  // - Level increases mỗi 6s => giảm thời gian giữa lần xuất hiện (spawnRate) và rút ngắn thời gian hiện (life)
  // - Sau 18s, có thể xuất hiện 2 nốt cùng lúc (multiSpawn)
  let gameTimer=null, spawnTimer=null, level=1, left=30, score=0;
  let spawnRate=900;     // ms, sẽ giảm theo level
  let life=900;          // thời gian một "chuột" tồn tại (ms)
  let multiSpawn=false;
  const holes=[...board.children];

  function setLevelByTime(){
    const elapsed = 30-left; // s
    const newLv = 1 + Math.floor(elapsed/6); // 1..5
    if(newLv!==level){
      level=newLv;
      document.getElementById('wamLv').textContent=level;
      // scale difficulty
      spawnRate = Math.max(350, 900 - (level-1)*120);
      life = Math.max(350, 900 - (level-1)*130);
      if(elapsed>=18) multiSpawn=true;
      restartSpawner();
    }
  }

  function spawnOnce(){
    // clear expired moles
    holes.forEach(h=>h.classList.remove('active'));
    // choose 1 or 2 holes
    const count = multiSpawn ? 1 + Math.round(Math.random()) : 1;
    const picks = [];
    while(picks.length<count){
      const idx = Math.floor(Math.random()*holes.length);
      if(!picks.includes(idx)) picks.push(idx);
    }
    picks.forEach(i=>{
      const hole = holes[i];
      hole.classList.add('active');
      // auto hide after life
      setTimeout(()=> hole.classList.remove('active'), life);
    });
  }

  function restartSpawner(){
    if(spawnTimer) clearInterval(spawnTimer);
    spawnTimer = setInterval(spawnOnce, spawnRate);
  }

  board.addEventListener('click',e=>{
    const hole=e.target.closest('.wam-hole'); if(!hole) return;
    if(hole.classList.contains('active')){
      score++; document.getElementById('wamScore').textContent=score;
      hole.classList.remove('active');
    }
  });

  document.getElementById('wamStart').addEventListener('click',()=>{
    // reset
    score=0; left=30; level=1; spawnRate=900; life=900; multiSpawn=false;
    document.getElementById('wamScore').textContent='0';
    document.getElementById('wamTime').textContent='30s';
    document.getElementById('wamLv').textContent='1';
    holes.forEach(h=>h.classList.remove('active'));

    // start timers
    if(gameTimer) clearInterval(gameTimer);
    if(spawnTimer) clearInterval(spawnTimer);
    gameTimer = setInterval(()=>{
      left--; document.getElementById('wamTime').textContent=left+'s';
      setLevelByTime();
      if(left<=0){
        clearInterval(gameTimer); clearInterval(spawnTimer);
        holes.forEach(h=>h.classList.remove('active'));
      }
    },1000);
    restartSpawner();
    spawnOnce(); // immediate first
  });
}


// ==== Render: only one game card ====
function renderInlineGames(){
  const grid=document.getElementById('games-grid'); if(!grid) return;
  grid.innerHTML='';
  const card=document.createElement('div'); card.className='game';
  card.innerHTML=`<div class="thumb whack"></div>
    <div class="body">
      <h5>Đập chuột (Whack‑a‑mole)</h5>
      <p>Chạm vào chuột chũi khi xuất hiện để ghi điểm trong 30s.</p>
      <button class="btn small">Chơi</button>
    </div>`;
  card.querySelector('button').addEventListener('click',()=>__modal.open({title:'Đập chuột (Whack‑a‑mole)',build:buildWhack}));
  card.querySelector('.thumb').addEventListener('click',()=>__modal.open({title:'Đập chuột (Whack‑a‑mole)',build:buildWhack}));
  grid.appendChild(card);
}

document.getElementById('calcBtn')?.addEventListener('click', ()=> { setTimeout(()=> renderInlineGames(), 0); });

</script>
</body>
</html>
